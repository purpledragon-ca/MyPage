<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Home ¬∑ Zilong Zhao</title>
  <link rel="stylesheet" href="../css/theme.css"/>
</head>
<body class="site">
  <div data-include="../partials/header.html"></div>

  <main class="section with-sidebar" id="hero">
    <div class="wrap" style="display:grid; gap:24px; align-items:center">
      <div data-include="../partials/sidebar.html"></div>
        <article>
        
        <h1 style="margin:0;font-size:clamp(2rem,4.5vw,3.25rem);line-height:1.15">
          I'm <span style="color:var(--primary)">Purple Dragon</span> 
          <br>I engineer <span style="color:var(--primary-2)">Robotics & AI</span> solutions.
        </h1>
        
        <p style="color:var(--muted); margin:0; font-size:1.2rem; line-height:1.65; max-width:80ch;">
          <br><br>
          I'm obsessed with robots for a simple reason: I want one could finally help me clean my room.
          <br><br>
          To get there, I've gone deep on the essentials: solid programming, a wide range of deep-learning methods, and a sturdy robotics foundation.
          I'm already building my own bots‚Äîstill learning, still improving‚Äîand getting closer to the day I never have to pick up stray wrappers again.
          <br><br>
          Around this site you'll find my 
          <a class="link-cta" href="./projects.html"><strong>Projects</strong><span class="icon"></span></a>
          and a clickable 
          <a class="link-cta" href="./skills.html"><strong>Skill Tree</strong><span class="icon"></span></a>, 
          organized by level (Beginner, Mid, Advanced). 
          Tap any skill to jump straight to the projects that use it.
        </p>

        <br><br>
        <div data-include="../pages/gallery.html"></div>
        
      </article>
    </div>
  </main>
  <script>
    (async function(){
      // Wait for includes to be loaded
      function waitForElement(id, maxAttempts = 50) {
        return new Promise((resolve) => {
          let attempts = 0;
          const checkExist = setInterval(() => {
            const element = document.getElementById(id);
            if (element) {
              clearInterval(checkExist);
              resolve(element);
            }
            attempts++;
            if (attempts >= maxAttempts) {
              clearInterval(checkExist);
              resolve(null);
            }
          }, 100); // Check every 100ms
        });
      }
      
      const grid = await waitForElement('grid3');
      const sentinel = await waitForElement('gallery-sentinel');
      
      if(!grid || !sentinel) {
        console.error('Gallery elements not found after waiting');
        return;
      }
      
      console.log('‚úÖ Gallery elements found, starting to load...');
    
      // Load projects from manifest.json
      let IMGS = [];
      
      try {
        // Try multiple paths
        const paths = ['../_projects/manifest.json', './_projects/manifest.json', '_projects/manifest.json'];
        let manifest = null;
        
        console.log('üîç Trying to load manifest...');
        console.log('üìç Current location:', window.location.href);
        
        for (const path of paths) {
          try {
            console.log(`  Attempting: ${path}`);
            const response = await fetch(path + '?t=' + Date.now(), { cache: 'no-store' });
            console.log(`  Response status: ${response.status}`);
            if (response.ok) {
              manifest = await response.json();
              console.log('‚úÖ Loaded manifest from:', path);
              break;
            }
          } catch (e) {
            console.log(`  Error: ${e.message}`);
            continue;
          }
        }
        
        if (!manifest || !manifest.projects) {
          throw new Error('Failed to load manifest');
        }
        
        // Filter projects with valid image covers (png/jpg only)
        const validProjects = manifest.projects.filter(p => {
          const cover = p.cover || '';
          return cover.match(/\.(png|jpg|jpeg)$/i);
        });
        
        if (validProjects.length === 0) {
          console.warn('No valid image projects found');
          return;
        }
        
        // Separate by level
        const advanced = validProjects.filter(p => p.level === 'advanced');
        const mid = validProjects.filter(p => p.level === 'mid');
        const others = validProjects.filter(p => p.level === 'junior');
        
        // Build image list: ensure at least 1 advanced and 1 mid
        const selectedProjects = [];
        
        // Add at least one advanced (if available)
        if (advanced.length > 0) {
          const randomAdv = advanced[Math.floor(Math.random() * advanced.length)];
          selectedProjects.push(randomAdv);
        }
        
        // Add at least one mid (if available)
        if (mid.length > 0) {
          const randomMid = mid[Math.floor(Math.random() * mid.length)];
          selectedProjects.push(randomMid);
        }
        
        // Add remaining projects randomly
        const remaining = [...advanced, ...mid, ...others];
        const shuffled = remaining.sort(() => Math.random() - 0.5);
        
        // Add more projects to reach a good gallery size (e.g., 12 total)
        const targetCount = Math.min(12, validProjects.length);
        while (selectedProjects.length < targetCount && shuffled.length > 0) {
          const project = shuffled.pop();
          if (!selectedProjects.find(p => p.id === project.id)) {
            selectedProjects.push(project);
          }
        }
        
        // Convert to image format
        IMGS = selectedProjects.map(p => {
          const coverPath = p.cover.startsWith('/') 
            ? p.cover 
            : `../_projects/${p.id}/${p.cover.replace(/^\.\//, '')}`;
          
          return {
            thumb: coverPath,
            large: coverPath,
            alt: p.title,
            projectUrl: `./project_page.html?id=${p.id}`,
            level: p.level
          };
        });
        
        console.log(`üì∏ Gallery: ${IMGS.length} projects loaded`);
        console.log(`   Advanced: ${IMGS.filter(i => i.level === 'advanced').length}`);
        console.log(`   Mid: ${IMGS.filter(i => i.level === 'mid').length}`);
        console.log(`   Junior: ${IMGS.filter(i => i.level === 'junior').length}`);
        
      } catch (error) {
        console.error('‚ùå Failed to load project images:', error);
        // Show error message to user
        grid.innerHTML = `
          <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--muted);">
            <p style="color: #ef4444;">‚ö†Ô∏è Failed to load projects</p>
            <p style="font-size: 0.9rem;">Check console (F12) for details</p>
            <p style="font-size: 0.85rem; margin-top: 10px;">Error: ${error.message}</p>
          </div>
        `;
        return; // Don't continue if manifest failed to load
      }
    
      let idx = 0;                 // Current load position
      const BATCH = 9;             // Load 9 images per batch (3 rows)
      let isLoading = false;       // Prevent multiple simultaneous loads
      let allLoaded = false;       // Track if all images are loaded
    
      function makeCard(item){
        const a = document.createElement('a');
        a.className = 'gcard panel';
        
        // Link to project page instead of just image
        if (item.projectUrl) {
          a.href = item.projectUrl;
        } else {
          a.href = item.large;
          a.target = '_blank';
          a.rel = 'noopener';
        }
        
        const img = document.createElement('img');
        img.src = item.thumb;
        img.alt = item.alt || '';
        img.loading = 'lazy';
        
        a.appendChild(img);
        return a;
      }
    
      function loadMore(){
        // Prevent loading if already loading or all loaded
        if (isLoading || allLoaded || IMGS.length === 0) return;
        
        isLoading = true;
        
        // Clear existing placeholder cards on first load
        if (idx === 0) {
          grid.innerHTML = '';
        }
        
        // Load images but don't exceed the total available
        let n = 0;
        while (n < BATCH && idx < IMGS.length){
          const item = IMGS[idx];
          grid.appendChild(makeCard(item));
          idx++; n++;
        }
        
        // Check if all images are loaded
        if (idx >= IMGS.length) {
          allLoaded = true;
          console.log(`‚úÖ All ${IMGS.length} projects loaded`);
          // Hide sentinel since we're done
          if (sentinel) sentinel.style.display = 'none';
        }
        
        isLoading = false;
      }
    
      // Initial batch
      loadMore();
    
      // Only set up observers if we have more to load
      if (IMGS.length > BATCH) {
        // Load more when sentinel enters the viewport
        const io = new IntersectionObserver(entries => {
          entries.forEach(e => {
            if (e.isIntersecting && !allLoaded) loadMore();
          });
        }, { rootMargin: '600px 0px' });
        io.observe(sentinel);
      
        // Fallback: trigger when user scrolls near the bottom
        window.addEventListener('scroll', () => {
          if (!allLoaded && window.innerHeight + window.scrollY >= document.body.offsetHeight - 200){
            loadMore();
          }
        }, { passive: true });
      } else {
        // If we have fewer images than BATCH, just hide the sentinel
        if (sentinel) sentinel.style.display = 'none';
      }
    })();
    </script>
    
  <div data-include="../partials/footer.html"></div>
  <script src="../js/include.js"></script>

</body>
</html>